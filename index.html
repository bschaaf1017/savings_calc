<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<div id="employee-calculator" class="savings-calculator">
  <div id="inputs" class="input-wrapper">
    <div class="calculator-input-group">

      <label>Paycheck Frequency</label><br>
      <div class="btn-group">
        <button id="freq-btn1" class="freq-btn btn-clicked" value=4>Weekly</button>
        <button id="freq-btn2" class="freq-btn" value=2.1>Bi-Weekly</button>
        <button id="freq-btn3" class="freq-btn" value=2>Semi-Monthly</button>
        <button id="freq-btn4" class="freq-btn" value=1>Monthly</button>
      </div>
    </div>
    <p class="calculator-input-group">
      <label>Amount saved per paycheck:</label><br>
      <input id="paycheck-savings" class="calculator-slider inputs" data-is-currency="true" type="range" min="1"
        max="250" value="5">
      <span id="paycheck-savings-value">$5.00</span>
    </p>
    <!-- <p class="calculator-input-group">
      <label>Age of Sunny Day FundÂ®:</label><br>
      <input id="sdf-age" class="calculator-slider inputs" type="range" min="3" max="60" step="3" value="9">
      <span id="sdf-age-value">9</span> months
    </p> -->
  </div>
  <!-- <div id="result-table" class="result-table">
    <table>
      <colgroup>
        <col>
        <col class="col1" span="1">
        <col>
        <col class="col2" span="1">
      </colgroup>
      <tr>
        <th></th>
        <th class="top-left">Without SDF</th>
        <th></th>
        <th class="top-right">With SDF</th>
      </tr>
      <tr>
        <th>Employee Contribution:</td>
        <td id="employee-contribution-without">$180.00</td>
        <th></th>
        <td id="employee-contribution-with">$180.00</td>
      </tr>
      <tr>
        <th>Employer Contribution:</td>
        <td>$0</td>
        <th></th>
        <td id="employer-contribution">$28.37</td>
      </tr>
      <tr>
        <th>Total Savings Potential:</th>
        <td id="savings-without-sdf">$180.00</td>
        <th></th>
        <td id="savings-with-sdf">$208.37</td>
      </tr>
      <tr>
        <th><strong>Effective Interest Rate (APY):</strong></th>
        <td class="bottom-left">0%</td>
        <th></th>
        <td id="sdf-intrest" class="bottom-right">13.62%</td>
      </tr>
    </table>
  </div> -->
  <canvas id="myChart" width="300" height="400"></canvas>
  <p class="res-container">
    The power of SDF makes you
    <span id="res-percent">27%</span>
    more resiliant than 47% of americans
  </p>
</div>
<script>
  let f = 4;

  const get = id => document.getElementById(id).value;
  const set = (id, value) => document.getElementById(id).innerText = value;

  const format = number => new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD'
  }).format(number);

  const formatPercent = num => new Intl.NumberFormat('default', {
    style: 'percent',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  }).format(num);

  const weeklyCalc = amt => amt * 4;
  const biWeekCalc = amt => amt * 2;
  const calcAnnualWithout = amt => amt * 12;
  const monthlyContribution = (cont, age) => cont / age

  const calculate = (event) => {
    const is_pointer_event = event instanceof PointerEvent

    if (is_pointer_event) {
      console.log('event: ', event.target.value)
      f = event.target.value

      const currClicked = new Promise((resolve, reject) => {
        const ele = document.getElementsByClassName('btn-clicked')
        resolve(ele)
      });

      currClicked
        .then((res) => res[0].setAttribute("class", "freq-btn"))
        .then(() => {
          document.getElementById(event.target.id).setAttribute("class", "btn-clicked")
        })
        .catch((err) => console.log('error:', err));
    }

    const display_elem_id = `${event.target.id}-value`;
    const is_currency_field = Boolean(event.target.dataset.isCurrency);
    const formatted_value = is_currency_field ? format(event.target.value) : event.target.value;

    if (event.target.children.length === 0 && !is_pointer_event) {
      set(display_elem_id, formatted_value);
    }

    const s = get('paycheck-savings');
    const q = 12;

    const monthlySavings =
     //if pay freq is weekly return savings * 4
      f === 'Weekly' ? weeklyCalc(s)
      // if everyother week return savings * 2 else return savings
        : f === 'Bi-Weekly' || f === 'Semi-Monthly'
          ? biWeekCalc(s) : s;

    const dailySavings = monthlySavings / 30;

    const yearlyEmpCont = () => {
      const yearlySavings = []
      for (let i = 1; i <= 5; i++) {
        let numMonths = i * 12
        yearlySavings.push(f * s * numMonths)
      }
      console.log('yearly savings===',yearlySavings)
    }
    yearlyEmpCont()

    const savings_without_sdf = monthlySavings * q;
    const employer_contribution = (savings_without_sdf * (1.05 ** (q / 3))) - savings_without_sdf;
    const employee_contribution3 = savings_without_sdf * .05
    console.log('333333:', employee_contribution3)
    const savings_with_sdf = savings_without_sdf + employer_contribution;
    // const sdf_intrest = calcAPY(savings_with_sdf, q, f, s, employer_contribution, savings_without_sdf)
    const sdf_intrest = CAGR(savings_without_sdf, savings_with_sdf, q)
    console.log('sdf_interest : ', sdf_intrest)
    const resilliant_num = savings_with_sdf / 250;
    console.log('resilliant_num: ', resilliant_num)

    set('employee-contribution-without', format(savings_without_sdf))
    set('employee-contribution-with', format(savings_without_sdf))
    set('employer-contribution', format(employer_contribution));
    set('savings-without-sdf', format(savings_without_sdf));
    set('savings-with-sdf', format(savings_with_sdf));
    set('sdf-intrest', formatPercent(sdf_intrest));
    set('res-percent', formatPercent(resilliant_num))
  };

  document.querySelectorAll('.inputs').forEach((slider) => {
    slider.addEventListener('input', calculate);
  });

  document.querySelectorAll('.freq-btn').forEach((btn) => {
    btn.addEventListener('click', calculate);
  })

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('paycheck-savings').dispatchEvent(new Event('input', {
      bubbles: true,
      cancelable: true
    }));
  });

  function CAGR(startVAl, endingValue, age) {
    const numOfPeriods = age / 3
    var CAGR = Math.pow((endingValue / startVAl), 1.05 / numOfPeriods) - 1;
  return Math.round(CAGR * 10000) / 100;
  }
  function calcAPY(total, age, freq, perCheckSavings, currCont, savings_without_sdf) {
    console.log('total: ', total, 'age: ', age, 'freq: ', freq, 'perCheckSavings: ', perCheckSavings);
    if (age < 12) {
      const newAge = 12 - age;
      if (freq === 'Weekly') {
        const remainYearSavings = weeklyCalc(perCheckSavings) * newAge;
        return returnAPY(total, remainYearSavings, newAge, currCont);
      } else if (freq === 'Bi-Weekly' || freq === 'Semi-Monthly') {
        const remainYearSavings = biWeekCalc(perCheckSavings) * newAge;
        return returnAPY(total, remainYearSavings, newAge, currCont);
      } else {
        const remainYearSavings = perCheckSavings * newAge;
        return returnAPY(total, remainYearSavings, newAge, currCont);
      }
    } else {
      const diff = total - savings_without_sdf
      return increasePercent = diff / savings_without_sdf;
    }
  }

  function returnAPY(totalSoFar, restOfyearSavings, remainingMonths, currCont) {
    const remainEmployerCont = (restOfyearSavings * (1.05 ** (remainingMonths / 3))) - restOfyearSavings;
    const totalYearEmployerCont = remainEmployerCont + currCont;
    const estimateYearlySavings = remainEmployerCont + restOfyearSavings + totalSoFar;
    return (estimateYearlySavings - (estimateYearlySavings - totalYearEmployerCont)) / (estimateYearlySavings - totalYearEmployerCont);
  }

  const colors = {
    green: {
      fill: '#e0eadf',
      stroke: '#5eb84d',
    },
    lightBlue: {
      stroke: '#6fccdd',
    },
    darkBlue: {
      fill: '#92bed2',
      stroke: '#3282bf',
    },
    purple: {
      fill: '#8fa8c8',
      stroke: '#75539e',
    },
  };
  const empData = [100,200, 300, 500, 1000]
  const ctx = document.getElementById('myChart').getContext('2d');
  const myChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
      datasets: [
        {
          label: 'Employee contributions',
          fill: true,
          backgroundColor: colors.purple.fill,
          pointBackgroundColor: colors.purple.stroke,
          borderColor: colors.purple.stroke,
          pointHighlightStroke: colors.purple.stroke,
          borderCapStyle: 'butt',
          data: empData,
        },
        {
          label: 'Total with Employer contributions',
          fill: true,
          backgroundColor: colors.darkBlue.fill,
          pointBackgroundColor: colors.darkBlue.stroke,
          borderColor: colors.darkBlue.stroke,
          pointHighlightStroke: colors.darkBlue.stroke,
          borderCapStyle: 'butt',
          data: [empData[0] + 20,empData[1]+40,empData[2] +60,empData[3] + 100,empData[4]+ 200],
        },
      ]
    },
    options: {
    responsive: false,
    // Can't just just `stacked: true` like the docs say
    scales: {
      yAxes: [{
        stacked: true,
      }]
    },
    animation: {
      duration: 750,
    },
  }
});


</script>

<style>
  .savings-calculator * {
    font-family: Montserrat, sans-serif;
  }

  .savings-calculator {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-around;
    padding: 25px 0;
    border: 2px solid #ffa926;
  }

  .input-wrapper {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .btn-group {
    display: flex;
    flex-direction: row;
    gap: 2px;
  }

  .freq-btn {
    width: fit-content;
    padding: 3px;
    background-color: #ffa926;
    border: 1px solid #004462;
    border-radius: 5px;
    color: #004462;
    cursor: pointer;
  }

  .btn-group button:hover {
    background-color: #004462;
    color: #ffa926;
  }

  .btn-clicked {
    background-color: #004462;
    border: 1px solid #004462;
    border-radius: 5px;
    color: #ffa926;
    cursor: pointer;
    width: fit-content;
    padding: 3px
  }

  .calculator-input-group {
    white-space: nowrap;
  }

  .calculator-input-group>* {
    vertical-align: middle;
  }

  .calculator-slider {
    -webkit-appearance: none;
    background: transparent;
    border: none !important;
    width: 100%;
  }

  .calculator-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    margin-top: -4px;
    border: 1px solid #000;
    height: 12px;
    width: 12px;
    border-radius: 6px;
    background: #004462;
  }

  .calculator-slider::-webkit-slider-runnable-track {
    background: #ffa926;
    height: 3px;
  }

  .calculator-slider::-moz-range-thumb {
    background: #004462;
  }

  .calculator-slider::-moz-range-track {
    height: 3px;
    background-color: #ffa926;
  }

  .calculator-slider:focus {
    outline: none;
  }

  .calculator-slider::-ms-track {
    width: 100%;
    cursor: pointer;
    background: transparent;
    border-color: transparent;
    color: transparent;
  }

  .calculator-savings-label {
    color: #ffa926;
    font-weight: bolder;
  }

  @media only screen and (max-width: 800px) {
    .savings-calculator {
      display: block;
      padding: 8%;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
      min-width: 310px;
    }

    .input-wrapper {
      width: 100%;
    }

    .btn-group {
      width: 100%;
    display: flex;
    flex-direction: row;
    justify-content: space-evenly;
  }

    .calculator-input-group {
      white-space: normal;
      width: 100%;
      display: flex;
      flex-direction: column;
      /* justify-content:center; */
      align-items: center;

    }

    .calculator-input-group>span {
      margin-top: 7px;
    }

    .calculator-slider {
      width: 100%;
    }

    .savings-calculator>div p {
      margin-bottom: 14px;
    }

  }

  @media only screen and (max-width: 730px) {
    .input-wrapper {
      display: flex;
      justify-content: center;
    }

    .top-inputs {
      display: flex;
      flex-direction: column;
    }
  }

  .result-table {
    display: flex;
    justify-content: center;
  }

  table {
    border: none;
    border-collapse: collapse;
  }

  .col1 {
    border: 2px solid #c9cccc;
  }

  .col2 {
    border: 2px solid #ffa926;
  }

  .top-left {
    background-color: #c9cccc;
    color: white;
  }

  .top-right {
    background-color: #ffa926;
    color: white;
  }

  th,
  td {
    padding: 5px;
    text-align: center
  }

  .res-container {
    /* display: flex;
    flex-direction: column; */
    flex-basis: 100%;
    height: 0;
    margin-bottom: auto;
    text-align: center;
    color: #ffa926;
  }
  #res-percent {
    color: #004462;
  }
</style>